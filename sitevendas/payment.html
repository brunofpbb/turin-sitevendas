<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Pagamento</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Esconde visualmente o seletor de parcelas do Payment Brick -->
  <style>
    [data-testid="installments"],
    .mp-CardPayment-installments,
    .mp-payment-installments,
    .mp-form-control--installments {
      display: none !important;
      visibility: hidden !important;
      height: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
      overflow: hidden !important;
    }

    /* Caixa do PIX */
    #pix-box{
      margin-top:16px; padding:14px; border:1px solid #e2e2e2; border-radius:10px;
      background:#fff;
    }
    #pix-box h4{ margin:0 0 8px 0 }
    #pix-box .pix-row{ display:flex; gap:8px; align-items:center; margin-top:8px }
    #pix-code{ flex:1; padding:.6rem; border:1px solid #ccc; border-radius:6px }
    #pix-copy{ padding:.6rem .9rem; border:0; border-radius:8px; cursor:pointer }
    #pix-status{ margin-top:8px; color:#555 }
    #pix-qr img{ max-width:220px; height:auto; }

    /* ===== Overlay de emissão do bilhete ===== */
    #issuance-overlay{
      position:fixed; inset:0; background:rgba(0,0,0,.45);
      display:none; align-items:center; justify-content:center;
      z-index:9999; backdrop-filter:saturate(120%) blur(1px);
    }
    #issuance-overlay .io-card{
      background:#fff; border-radius:14px; padding:22px 26px; text-align:center;
      box-shadow:0 12px 40px rgba(0,0,0,.25); max-width:520px; width:92%;
    }
    #issuance-overlay .io-title{ font:600 18px/1.25 system-ui,-apple-system,Segoe UI,Roboto,sans-serif; margin-top:12px; }
    #issuance-overlay .io-sub{ font:400 13px/1.35 system-ui,-apple-system,Segoe UI,Roboto,sans-serif; color:#555; margin-top:6px; }
    #issuance-overlay .io-spinner{
      width:48px; height:48px; margin:0 auto;
      border-radius:50%; border:4px solid #e6e6e6; border-top-color:#2563eb;
      animation:io-spin 1s linear infinite;
    }
    @keyframes io-spin{ to{ transform:rotate(360deg); } }
  </style>

  <!-- SDK do Mercado Pago deve vir antes do seu payment.js -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <script defer src="main.js"></script>
  <script defer src="payment.js"></script>

  <!-- JS utilitário: deixa as funções globais para o payment.js usar -->
  <script>
    function showIssuanceOverlay(msg){
      const el = document.getElementById('issuance-overlay');
      if(!el) return;
      if(msg) el.querySelector('.io-title').textContent = msg;
      el.style.display = 'flex';
      // evita scroll/duplo clique
      document.body.style.pointerEvents = 'none';
      document.body.style.overflow = 'hidden';
    }
    function hideIssuanceOverlay(){
      const el = document.getElementById('issuance-overlay');
      if(!el) return;
      el.style.display = 'none';
      document.body.style.pointerEvents = '';
      document.body.style.overflow = '';
    }
    // se a página for descarregada, garante que o overlay não "grude"
    window.addEventListener('beforeunload', () => hideIssuanceOverlay());
  </script>
</head>
<body>
  <header>
    <h1>Turin Transportes – Pagamento</h1>
    <nav id="user-nav"></nav>
  </header>

  <main class="two-cols-pay">
    <!-- Card lateral fixo: Resumo -->
    <aside class="summary-card" id="summary-card">
      <h2 class="step-title">Resumo do Pedido</h2>
      <div id="summary-body"><!-- preenchido pelo payment.js --></div>
      <div class="summary-total"><span>Total</span><strong id="summary-total">R$ 0,00</strong></div>
      <div class="actions">
        <button id="btn-cancel" class="btn btn-ghost">Cancelar</button>
      </div>
    </aside>

    <!-- Card central: Bricks -->
    <section class="content-card" id="bricks-card">
      <h2 class="step-title">Informações de Pagamento</h2>
      <p class="mute">Pagamento seguro via Checkout API do Mercado Pago (Bricks).</p>

      <!-- Container do Brick -->
      <div id="payment-bricks" style="margin-top:12px;"></div>

      <!-- Resultado PIX (criado/atualizado pelo JS) -->
      <div id="pix-box" style="display:none">
        <h4>Pagamento via Pix</h4>
        <div id="pix-qr"></div>
        <div class="pix-row">
          <input id="pix-code" type="text" readonly>
          <button id="pix-copy" type="button" class="btn">Copiar código</button>
        </div>
        <p id="pix-status">Aguardando pagamento…</p>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Turin Transportes</p>
  </footer>

  <!-- Overlay de carregamento -->
  <div id="issuance-overlay">
    <div class="io-card">
      <div class="io-spinner" aria-hidden="true"></div>
      <div class="io-title">Emitindo bilhete, por favor aguarde!</div>
      <div class="io-sub">Estamos confirmando sua compra e gerando o DABP-e…</div>
    </div>
  </div>
</body>
</html>
